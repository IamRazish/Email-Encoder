<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Email Address Encoder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      line-height: 1.4;
    }
    h1 { font-size: 1.75rem; margin-bottom: .5rem; }
    label { display: block; margin-top: 1rem; font-weight: 600; }
    input, select, textarea { width: 100%; padding: .5rem; margin-top: .25rem; box-sizing: border-box; }
    button { margin-top: 1rem; padding: .6rem 1.2rem; cursor: pointer; }
    .output { background: #f5f5f5; padding: 1rem; border: 1px solid #ccc; margin-top: .5rem; font-family: monospace; white-space: pre-wrap; word-break: break-all; position: relative; }
    .copy-btn { position: absolute; top: 5px; right: 5px; }
    .preview { margin-top: .75rem; }
    .small { font-size: .85rem; color: #555; }
  </style>
</head>
<body>
  <h1>Email Address Encoder</h1>
  <p>This tool generates an obfuscated mailto link by encoding the email, link text, and optional subject using HTML character entities (decimal, hex, or mixed). It's intended to raise the bar slightly for naive scrapers.</p>

  <label>
    Email address:
    <input type="text" id="email" placeholder="you@example.com" value="you@example.com" />
  </label>

  <label>
    Link text (what the user sees):
    <input type="text" id="linkText" placeholder="Contact me" value="Contact me" />
  </label>

  <label>
    Subject (optional):
    <input type="text" id="subject" placeholder="Hello!" />
  </label>

  <label>
    Encoding type:
    <select id="encodingType">
      <option value="decimal">Decimal entities (e.g. &#123;)</option>
      <option value="hex">Hex entities (e.g. &#x7b;)</option>
      <option value="mixed">Mixed (randomly decimal or hex per char)</option>
    </select>
  </label>

  <div style="display:inline-flex; gap:8px;">
  <button id="encodeBtn">Encode</button>
  <button id="resetBtn" type="button">Reset</button>
</div>

  <div class="output" id="outputArea" aria-live="polite">
    <!-- result will appear here -->
  </div>

  <div class="preview" id="previewContainer">
    <div><strong>Rendered link:</strong></div>
    <div id="renderedLink"></div>
  </div>

  <script>
    function encodeChar(c, mode) {
      const code = c.charCodeAt(0);
      if (mode === 'decimal') {
        return '&#' + code + ';';
      } else if (mode === 'hex') {
        return '&#x' + code.toString(16) + ';';
      } else if (mode === 'mixed') {
        if (Math.random() < 0.5) {
          return '&#' + code + ';';
        } else {
          return '&#x' + code.toString(16) + ';';
        }
      } else {
        return c;
      }
    }

    function encodeString(str, mode) {
      return Array.from(str).map(c => encodeChar(c, mode)).join('');
    }

    function doEncode() {
      const emailRaw = document.getElementById('email').value.trim();
      if (!emailRaw) {
        alert('Please enter an email address.');
        return;
      }
      const linkTextRaw = document.getElementById('linkText').value || emailRaw;
      const subjectRaw = document.getElementById('subject').value.trim();
      const mode = document.getElementById('encodingType').value;

      const encodedEmail = encodeString(emailRaw, mode);
      const encodedLinkText = encodeString(linkTextRaw, mode);
      let href = 'mailto:' + encodedEmail;
      if (subjectRaw) {
        const subjectParam = encodeURIComponent(subjectRaw);
        href += '?subject=' + subjectParam;
      }

      const anchor = `<a href="${href}">${encodedLinkText}</a>`;
      document.getElementById('outputArea').textContent = anchor;
      const previewDiv = document.getElementById('renderedLink');
      previewDiv.innerHTML = anchor;
      addCopyButton();
    }

    function addCopyButton() {
      const out = document.getElementById('outputArea');
      if (document.getElementById('copyBtn')) return;
      const btn = document.createElement('button');
      btn.textContent = 'Copy to clipboard';
      btn.id = 'copyBtn';
      btn.className = 'copy-btn';
      btn.addEventListener('click', () => {
        navigator.clipboard.writeText(out.textContent).then(() => {
          btn.textContent = 'Copied!';
          setTimeout(() => { btn.textContent = 'Copy to clipboard'; }, 1500);
        }, () => {
          alert('Copy failed; please select and copy manually.');
        });
      });
      out.style.position = 'relative';
      out.appendChild(btn);
    }

    // new reset function
    function resetForm() {
      document.getElementById('email').value = 'you@example.com';
      document.getElementById('linkText').value = 'Contact me';
      document.getElementById('subject').value = '';
      document.getElementById('encodingType').value = 'decimal';
      doEncode();
    }

    document.getElementById('encodeBtn').addEventListener('click', doEncode);
    document.getElementById('resetBtn').addEventListener('click', resetForm);
    doEncode();
  </script>
</body>
</html>
